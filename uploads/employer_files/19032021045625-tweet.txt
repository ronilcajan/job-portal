<?php
/*
Plugin Name: Display Latest Tweets
Plugin URI: https://ellingtonmarketing.com
Description: Displays Latest Tweet from an account via shortcode
Version: 1.0.0
Author: Zack Ellington
Author URI: https://ellingtonmarketing.com
License: GPL2
*/

	//Include the Library
	require "twitteroauth/autoload.php";
	use Abraham\TwitterOAuth\TwitterOAuth;

function displaytweet_shortcode( $atts ) {

	// Attributes
	$atts = shortcode_atts(
		array(
			'twitteruser' => '',
			'count' => '',
		),
		$atts,
		'displaytweet'
	);

	//Oauth Credentials
	$consumer_key = 'Dwq3KpjY2kZk48U0d5JHUQ';
	$consumer_secret = 'gRyMIoQtz8PpUlzPfUwWht3onM6mlfK8PlEqVf853k';
	$access_token = '28444743-i4gVg3oxIq3uY5jVMw29pUtQzCXJ7LTlzgV1bs6u0';
	$access_token_secret = 'ZpGpryLJ2pmo9LNVz3DpnKs11DNwN4XCqC5pf4RFh94Gk';

	
	
	// Establish connection to Twitter API
	$connection = new TwitterOAuth($consumer_key, $consumer_secret, $access_token, $access_token_secret);
	$connection->setTimeouts(10, 15);

	//Get Latest Tweet
	$latest_tweet = $connection->get("statuses/user_timeline", ["screen_name" => $atts['twitteruser'], "count" => $atts['count'], "exclude_replies" => true, "tweet_mode" => "extended"]);
	
	$returnTweets = "<div class='sticky-scrolling-feed'>";
	
	foreach ($latest_tweet as $status) {
		$date = $status->created_at;
		$returnTweets = $returnTweets . "<div>" . $status->text . " <span>(" . date("M d", strtotime($date)) . ")</span></div>";
	}
	
	$returnTweets = $returnTweets . "</div>";
	return $returnTweets;
}
add_shortcode( 'displaytweet', 'displaytweet_shortcode' );


?>
